--- Find total donations sums for each donation
create view view_donations_paid as select di.donation_id,sum(di.invoice_amount) total,di.invoice_status status,d.target_amount target,round((sum(di.invoice_amount)/d.target_amount),4) percentage from invoices di, donations d where d.id=di.donation_id and  invoice_status='PROCESSED' group by di.donation_id,di.invoice_status, d.target_amount;
create view view_donations_pending as select di.donation_id,sum(di.invoice_amount) total,di.invoice_status status,d.target_amount target,round((sum(di.invoice_amount)/d.target_amount),4) percentage from invoices di, donations d where d.id=di.donation_id and  invoice_status='PENDING' group by di.donation_id,di.invoice_status, d.target_amount;
create view view_donations_ugly as select di.donation_id,sum(di.invoice_amount) total,di.invoice_status status,d.target_amount target,round((sum(di.invoice_amount)/d.target_amount),4) percentage from invoices di, donations d where d.id=di.donation_id and  invoice_status not in ('PROCESSED','PENDING') group by di.donation_id,di.invoice_status, d.target_amount;
create view view_donations_analysis as select d.*,d.target_amount target,COALESCE((select total from view_donations_paid where donation_id=d.id), 0) paid,COALESCE((select total from view_donations_pending where donation_id=d.id),0) pending,COALESCE((select total from view_donations_ugly where donation_id=d.id),0) ugly from donations d;